---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const postUrl = `https://www.abdelkbirnainiaa.me/blog/${post.slug}`;
const postImage = post.data.heroImage ? `https://www.abdelkbirnainiaa.me${post.data.heroImage}` : "https://www.abdelkbirnainiaa.me/myimg.png";
---

<Layout
  title={`${post.data.title} | Abdelkbir Nainiaa`}
  description={post.data.description}
  image={postImage}
  canonical={postUrl}
  type="article"
>
  <!-- Blog Article Structured Data -->
  <script type="application/ld+json" slot="head">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "{post.data.title}",
      "description": "{post.data.description}",
      "image": "{postImage}",
      "datePublished": "{post.data.pubDate.toISOString()}",
      "dateModified": "{post.data.updatedDate ? post.data.updatedDate.toISOString() : post.data.pubDate.toISOString()}",
      "author": {
        "@type": "Person",
        "@id": "https://www.abdelkbirnainiaa.me/#person",
        "name": "Abdelkbir Nainiaa"
      },
      "publisher": {
        "@type": "Person",
        "name": "Abdelkbir Nainiaa",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.abdelkbirnainiaa.me/ANlogo.png"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{postUrl}"
      },
      "url": "{postUrl}",
      "inLanguage": "en-US"
    }
  </script>
  
  <main class="container my-24 px-5 prose dark:prose-invert lg:prose-xl">
    <img src={post.data.heroImage} alt={post.data.title} class="w-full rounded-lg mb-8" />
    <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
    <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">{post.data.description}</p>
    <article>
      <Content />
    </article>
  </main>
</Layout>
